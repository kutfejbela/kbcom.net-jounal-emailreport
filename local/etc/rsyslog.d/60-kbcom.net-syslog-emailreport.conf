module(load="omprog")

template(
  name="EMailLine"
  type="string"
  string="%syslogfacility-text%.%syslogpriority-text% %rawmsg:::drop-last-lf%\n"
)

*.warning,authpriv.notice
  action(
    type="omprog"
    binary="/etc/rsyslog.d/sendemail-later.bash"
    template="EMailLine"
  )

authpriv.notice
  action(
    type="omprog"
    binary="/etc/rsyslog.d/sendemail-immediately.bash"
    template="EMailLine"
  )

if $syslogfacility-text == "authpriv" and $msg contains_i "success" then
{
  action(
    type="omprog"
    binary="/etc/rsyslog.d/sendemail-immediately.bash"
    template="EMailLine"
  )
}
